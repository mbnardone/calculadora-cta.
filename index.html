<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Valor Total</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .input-cell {
            background-color: #fffbeb; /* yellow-50 */
            border-color: #fde047; /* yellow-300 */
        }
        .impact-col {
            background-color: #f3f4f6; /* gray-100 */
            font-weight: 600;
        }
        .gain-cell {
            color: #16a34a; /* green-600 */
        }
        .cost-cell {
            color: #dc2626; /* red-600 */
        }
        .final-impact-cell {
            background-color: #ecfdf5; /* green-50 */
            font-weight: 700;
        }
        .total-value-cell {
            background-color: #dbeafe; /* blue-100 */
            font-weight: 700;
        }
        .header-cell {
            background-color: #1e3a8a; /* blue-900 */
            color: white;
        }
        input[type="number"] {
            text-align: right;
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
        }
        input[type="number"]:focus {
            outline: 2px solid #3b82f6;
            border-color: transparent;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 md:p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-2">Calculadora de Valor Total</h1>
        <p class="text-gray-600 mb-6">Completa las celdas amarillas para ver el impacto real y acumulado de cada concepto.</p>

        <!-- SECCIÓN DE INPUTS -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="md:col-span-1">
                <h2 class="text-lg font-semibold text-gray-700 mb-3">1. Datos de Entrada</h2>
                 <div class="space-y-2">
                    <div>
                        <label class="text-sm font-medium text-gray-600">Monto Ventas a Procesar ($)</label>
                        <input type="number" class="input-cell w-full mt-1" id="monto-total" value="1000000">
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-600">Costo Capital Anual (TNA %)</label>
                        <input type="number" class="input-cell w-full mt-1" id="capital-anual" value="45">
                    </div>
                </div>
            </div>
            <div class="md:col-span-1">
                <h2 class="text-lg font-semibold text-gray-700 mb-3">2. Mercado Pago</h2>
                <div class="space-y-2">
                    <input type="number" class="input-cell" id="aprobacion-mp" value="95" title="Tasa de Aprobación (%)">
                    <input type="number" class="input-cell" id="comision-mp" value="2.99" title="Comisión por Venta (%)">
                    <input type="number" class="input-cell" id="financiacion-mp" value="9.7" title="Tasa de Financiación (%)">
                    <input type="number" class="input-cell" id="fraude-mp" value="0.0" title="Cargo por Motor de Fraude (%)">
                    <input type="number" class="input-cell" id="contracargo-mp" value="0.0" title="Pérdida por Contracargo (%)">
                    <input type="number" class="input-cell" id="liberacion-mp" value="2" title="Plazo de Liberación (días)">
                </div>
            </div>
            <div class="md:col-span-1">
                <h2 class="text-lg font-semibold text-gray-700 mb-3">3. Competidor</h2>
                 <div class="space-y-2">
                    <input type="number" class="input-cell" id="aprobacion-comp" value="87" title="Tasa de Aprobación (%)">
                    <input type="number" class="input-cell" id="comision-comp" value="2.99" title="Comisión por Venta (%)">
                    <input type="number" class="input-cell" id="financiacion-comp" value="8.9" title="Tasa de Financiación (%)">
                    <input type="number" class="input-cell" id="fraude-comp" value="0.5" title="Cargo por Motor de Fraude (%)">
                    <input type="number" class="input-cell" id="contracargo-comp" value="0.4" title="Pérdida por Contracargo (%)">
                    <input type="number" class="input-cell" id="liberacion-comp" value="10" title="Plazo de Liberación (días)">
                </div>
            </div>
        </div>

        <!-- SECCIÓN DE RESULTADOS -->
        <h2 class="text-lg font-semibold text-gray-700 mb-3">4. Cálculo de Impacto Acumulado</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full border-collapse" id="cta-table">
                <thead>
                    <tr>
                        <th class="header-cell p-3 text-left text-sm font-semibold rounded-tl-lg">Concepto</th>
                        <th class="header-cell p-3 text-center text-sm font-semibold">Mercado Pago</th>
                        <th class="header-cell p-3 text-center text-sm font-semibold">Impacto Acumulado MP</th>
                        <th class="header-cell p-3 text-center text-sm font-semibold">Competidor</th>
                        <th class="header-cell p-3 text-center text-sm font-semibold rounded-tr-lg">Impacto Acumulado Comp.</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="border-b">
                        <td class="p-3 font-semibold">Ventas Aprobadas</td>
                        <td class="p-3 text-right font-semibold gain-cell" id="val-aprob-mp"></td>
                        <td class="p-3 text-right impact-col" id="imp-aprob-mp"></td>
                        <td class="p-3 text-right font-semibold gain-cell" id="val-aprob-comp"></td>
                        <td class="p-3 text-right impact-col" id="imp-aprob-comp"></td>
                    </tr>
                    <tr class="border-b">
                        <td class="p-3">Costo Comisión</td>
                        <td class="p-3 text-right cost-cell" id="val-com-mp"></td>
                        <td class="p-3 text-right impact-col" id="imp-com-mp"></td>
                        <td class="p-3 text-right cost-cell" id="val-com-comp"></td>
                        <td class="p-3 text-right impact-col" id="imp-com-comp"></td>
                    </tr>
                     <tr class="border-b">
                        <td class="p-3">Costo Financiación</td>
                        <td class="p-3 text-right cost-cell" id="val-fin-mp"></td>
                        <td class="p-3 text-right impact-col" id="imp-fin-mp"></td>
                        <td class="p-3 text-right cost-cell" id="val-fin-comp"></td>
                        <td class="p-3 text-right impact-col" id="imp-fin-comp"></td>
                    </tr>
                     <tr class="border-b">
                        <td class="p-3">Costo Fraude</td>
                        <td class="p-3 text-right cost-cell" id="val-fra-mp"></td>
                        <td class="p-3 text-right impact-col" id="imp-fra-mp"></td>
                        <td class="p-3 text-right cost-cell" id="val-fra-comp"></td>
                        <td class="p-3 text-right impact-col" id="imp-fra-comp"></td>
                    </tr>
                     <tr class="border-b">
                        <td class="p-3">Costo Contracargo</td>
                        <td class="p-3 text-right cost-cell" id="val-cc-mp"></td>
                        <td class="p-3 text-right impact-col" id="imp-cc-mp"></td>
                        <td class="p-3 text-right cost-cell" id="val-cc-comp"></td>
                        <td class="p-3 text-right impact-col" id="imp-cc-comp"></td>
                    </tr>
                     <tr class="border-b">
                        <td class="p-3">Efecto Plazo (Costo Financiero)</td>
                        <td class="p-3 text-right cost-cell" id="val-plazo-mp"></td>
                        <td class="p-3 text-right impact-col" id="imp-plazo-mp"></td>
                        <td class="p-3 text-right cost-cell" id="val-plazo-comp"></td>
                        <td class="p-3 text-right impact-col" id="imp-plazo-comp"></td>
                    </tr>
                    <tr class="border-b">
                        <td class="p-3 font-bold text-gray-800">Resultado Neto Final</td>
                        <td class="p-3 text-right"></td>
                        <td class="p-3 text-right final-impact-cell" id="res-final-mp"></td>
                        <td class="p-3 text-right"></td>
                        <td class="p-3 text-right final-impact-cell" id="res-final-comp"></td>
                    </tr>
                     <tr class="bg-gray-50">
                        <td class="p-4 font-bold text-blue-800 text-lg" colspan="3">Valor Neto Adicional con Mercado Pago</td>
                        <td class="p-4 text-right font-bold text-blue-800 text-lg total-value-cell" colspan="2" id="valor-neto-total"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const formatCurrency = (value, showSign = false) => {
            const sign = value > 0 ? '+' : value < 0 ? '-' : '';
            const formatted = new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(Math.abs(value));
            return showSign ? `${sign} ${formatted}` : formatted;
        };

        function calculateCTA() {
            // --- 1. LEER INPUTS ---
            const montoTotal = parseFloat(document.getElementById('monto-total').value) || 0;
            const capitalAnual = (parseFloat(document.getElementById('capital-anual').value) || 0) / 100;
            
            const mp = {
                aprob: (parseFloat(document.getElementById('aprobacion-mp').value) || 0) / 100,
                com: (parseFloat(document.getElementById('comision-mp').value) || 0) / 100,
                fin: (parseFloat(document.getElementById('financiacion-mp').value) || 0) / 100,
                fra: (parseFloat(document.getElementById('fraude-mp').value) || 0) / 100,
                cc: (parseFloat(document.getElementById('contracargo-mp').value) || 0) / 100,
                plazo: parseInt(document.getElementById('liberacion-mp').value) || 0,
            };
            const comp = {
                aprob: (parseFloat(document.getElementById('aprobacion-comp').value) || 0) / 100,
                com: (parseFloat(document.getElementById('comision-comp').value) || 0) / 100,
                fin: (parseFloat(document.getElementById('financiacion-comp').value) || 0) / 100,
                fra: (parseFloat(document.getElementById('fraude-comp').value) || 0) / 100,
                cc: (parseFloat(document.getElementById('contracargo-comp').value) || 0) / 100,
                plazo: parseInt(document.getElementById('liberacion-comp').value) || 0,
            };

            // --- 2. CALCULAR VALORES BASE ---
            const ventasAprobadasMp = montoTotal * mp.aprob;
            const ventasAprobadasComp = montoTotal * comp.aprob;

            // --- 3. CALCULAR CADA COMPONENTE Y EL IMPACTO ACUMULADO ---
            
            // Mercado Pago
            let runningTotalMp = ventasAprobadasMp;
            document.getElementById('val-aprob-mp').textContent = formatCurrency(ventasAprobadasMp, true);
            document.getElementById('imp-aprob-mp').textContent = formatCurrency(runningTotalMp);

            const costoComMp = ventasAprobadasMp * mp.com;
            runningTotalMp -= costoComMp;
            document.getElementById('val-com-mp').textContent = formatCurrency(-costoComMp, true);
            document.getElementById('imp-com-mp').textContent = formatCurrency(runningTotalMp);

            const costoFinMp = ventasAprobadasMp * mp.fin;
            runningTotalMp -= costoFinMp;
            document.getElementById('val-fin-mp').textContent = formatCurrency(-costoFinMp, true);
            document.getElementById('imp-fin-mp').textContent = formatCurrency(runningTotalMp);
            
            const costoFraMp = ventasAprobadasMp * mp.fra;
            runningTotalMp -= costoFraMp;
            document.getElementById('val-fra-mp').textContent = formatCurrency(-costoFraMp, true);
            document.getElementById('imp-fra-mp').textContent = formatCurrency(runningTotalMp);

            const costoCcMp = ventasAprobadasMp * mp.cc;
            runningTotalMp -= costoCcMp;
            document.getElementById('val-cc-mp').textContent = formatCurrency(-costoCcMp, true);
            document.getElementById('imp-cc-mp').textContent = formatCurrency(runningTotalMp);

            const costoPlazoMp = (ventasAprobadasMp * (capitalAnual / 365)) * mp.plazo;
            runningTotalMp -= costoPlazoMp;
            document.getElementById('val-plazo-mp').textContent = formatCurrency(-costoPlazoMp, true);
            document.getElementById('imp-plazo-mp').textContent = formatCurrency(runningTotalMp);

            document.getElementById('res-final-mp').textContent = formatCurrency(runningTotalMp);

            // Competidor
            let runningTotalComp = ventasAprobadasComp;
            document.getElementById('val-aprob-comp').textContent = formatCurrency(ventasAprobadasComp, true);
            document.getElementById('imp-aprob-comp').textContent = formatCurrency(runningTotalComp);

            const costoComComp = ventasAprobadasComp * comp.com;
            runningTotalComp -= costoComComp;
            document.getElementById('val-com-comp').textContent = formatCurrency(-costoComComp, true);
            document.getElementById('imp-com-comp').textContent = formatCurrency(runningTotalComp);

            const costoFinComp = ventasAprobadasComp * comp.fin;
            runningTotalComp -= costoFinComp;
            document.getElementById('val-fin-comp').textContent = formatCurrency(-costoFinComp, true);
            document.getElementById('imp-fin-comp').textContent = formatCurrency(runningTotalComp);
            
            const costoFraComp = ventasAprobadasComp * comp.fra;
            runningTotalComp -= costoFraComp;
            document.getElementById('val-fra-comp').textContent = formatCurrency(-costoFraComp, true);
            document.getElementById('imp-fra-comp').textContent = formatCurrency(runningTotalComp);

            const costoCcComp = ventasAprobadasComp * comp.cc;
            runningTotalComp -= costoCcComp;
            document.getElementById('val-cc-comp').textContent = formatCurrency(-costoCcComp, true);
            document.getElementById('imp-cc-comp').textContent = formatCurrency(runningTotalComp);

            const costoPlazoComp = (ventasAprobadasComp * (capitalAnual / 365)) * comp.plazo;
            runningTotalComp -= costoPlazoComp;
            document.getElementById('val-plazo-comp').textContent = formatCurrency(-costoPlazoComp, true);
            document.getElementById('imp-plazo-comp').textContent = formatCurrency(runningTotalComp);

            document.getElementById('res-final-comp').textContent = formatCurrency(runningTotalComp);

            // --- 4. CALCULAR VALOR NETO TOTAL ---
            const valorNetoTotal = runningTotalMp - runningTotalComp;
            document.getElementById('valor-neto-total').textContent = formatCurrency(valorNetoTotal, true);
        }

        const allInputs = document.querySelectorAll('input[type="number"]');
        allInputs.forEach(input => input.addEventListener('input', calculateCTA));

        window.addEventListener('load', calculateCTA);
    </script>
</body>
</html>
